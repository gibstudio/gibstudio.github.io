<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Build Android on Mac OS X | Genie in a Bottle</title>
    <meta name="generator" content="GravCMS" />
<meta name="author" content="Iaroslav Veikov (Yaroslav Veykov)" />
<meta name="description" content="A small mobile team founded by a group of like-minded people with extensive experience in development of Android and iOS applications, with great interest in game development etc." />
<meta name="keywords" content="mobile development, mobile programming, ios development, ios apps, iphone development, ipad development, android development, android apps, genie in a bottle, Yaroslav Veykov, Iaroslav Veikov" />
<meta name="geo.position" content="44.81489232206759, 20.44794522261786" />
<meta name="geo.placename" content="Belgrade, Serbia" />
<meta name="geo.region" content="ru" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" type="image/png" href="../user/themes/freematter/images/favicon.png" />
    <link rel="canonical" href="https://gibstudio.github.io/build-android-mac-os.html" />

                                                    
                        <link href="../user/themes/freematter/css/pure-0.5.0/grids-min.css" type="text/css" rel="stylesheet" />
<link href="../user/themes/freematter/css-compiled/nucleus.css" type="text/css" rel="stylesheet" />
<link href="../user/themes/freematter/css-compiled/template.css" type="text/css" rel="stylesheet" />
<link href="../user/themes/freematter/css/font-awesome.min.css" type="text/css" rel="stylesheet" />
<link href="../user/plugins/markdown-notices/assets/notices.css" type="text/css" rel="stylesheet" />
<link href="../user/plugins/breadcrumbs/css/breadcrumbs.css" type="text/css" rel="stylesheet" />
<link href="../user/plugins/form/assets/form-styles.css" type="text/css" rel="stylesheet" />
<link href="../user/plugins/langswitcher/css/langswitcher.css" type="text/css" rel="stylesheet" />
<link href="../user/plugins/simplesearch/css/simplesearch.css" type="text/css" rel="stylesheet" />
<link href="../user/plugins/highlight/css/default.css" type="text/css" rel="stylesheet" />
<link href="../user/plugins/login/css/login.css" type="text/css" rel="stylesheet" />
<link href="../user/themes/freematter/css/slidebars.min.css" type="text/css" rel="stylesheet" />


                                            <script src="../system/assets/jquery/jquery-2.1.4.min.js" type="text/javascript" ></script>
<script src="../user/themes/freematter/js/modernizr.custom.71422.js" type="text/javascript" ></script>
<script src="../user/plugins/highlight/js/highlight.pack.js" type="text/javascript" ></script>
<script src="../user/themes/freematter/js/antimatter.js" type="text/javascript" ></script>
<script src="../user/themes/freematter/js/slidebars.min.js" type="text/javascript" ></script>

<script>
$(document).ready(function() {
                    $('pre code').each(function(i, block) {
                        hljs.highlightBlock(block);
                    });
                 });

</script>


</head>
<body id="top" class="">
    <div id="sb-site">
                <header id="header">
            <div id="logo">
                <h3><a href="../index.html"><i class="fa fa-flask"></i></a></h3>
            </div>
            <div id="navbar">
                                
                					<ul class="langswitcher">


                    
	    
	
    <li><a href="build-android-mac-os.html" class="external active">English</a></li>


                    
	    
	
    <li><a href="../ru/random.html" class="external">Русский</a></li>

</ul>
                                
                					
<ul class="navigation">
                                    <li class="">
                <a href="../index.html">
                                        Home
                </a>
            </li>
                                <li class="active">
                <a href="../blog.html">
                                        Blog
                </a>
            </li>
                                <li class="">
                <a href="../privacy-policy.html">
                                        Privacy Policy
                </a>
            </li>
                                <li class="">
                <a href="../berryboom.html">
                                        Berry Boom!
                </a>
            </li>
                                <li class="">
                <a href="../turbofinger.html">
                                        Turbofinger
                </a>
            </li>
                                <li class="">
                <a href="../fingertron.html">
                                        Fingertron
                </a>
            </li>
                    </ul>

                                <span class="panel-activation sb-toggle-left navbar-left menu-btn fa fa-bars"></span>
            </div>
        </header>
        
        
                <section id="body" class="">
            					
<div id="breadcrumbs" itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                                            <a href="../index.html" itemprop="url"><span itemprop="title">Home</span></a>
                        <i class="fa fa-angle-right"></i>
                                                <a href="../blog.html" itemprop="url"><span itemprop="title">Blog</span></a>
                        <i class="fa fa-angle-right"></i>
                                                <span itemprop="title">Build Android on Mac OS X</span>
                        </div>
				
		<div class="blog-content-item grid pure-g-r">
			<div id="item" class="block pure-u-2-3 h-entry">
			    <div class="list-item h-entry">

                
    <div class="list-blog-header">
        <span class="list-blog-date">
            <time class="dt-published" datetime="2017-04-30T19:00:00+03:00">
                <span>30</span>
                <em>Apr</em>
            </time>
        </span>
                    				<h2 class="p-name">Build Android on Mac OS X</h2>
			        
                <span class="tags">
                        <a href="./tag:macOS.html" class="p-category">macOS</a>
                        <a href="./tag:android.html" class="p-category">android</a>
                        <a href="./tag:build.html" class="p-category">build</a>
                        <a href="./tag:development.html" class="p-category">development</a>
                    </span>
                                                                    
            				<img src="../images/c/d/a/d/e/cdadefd1e8a6c4934e73a1e6f06a047cb186a5b9-header.jpeg" />
			        
    </div>

    <div class="list-blog-padding">

            <div class="e-content">
            <p><strong><em>Disclaimer: it's translation of my article that was written in Russian some time ago. All mentioned versions of software are outdated now. But anyway, it can be helpful :).</em></strong></p>
<p>For one of my projects I needed to improve original Android sources to create firmware for specific hardware. The version of Android was chosen quite old — AOSP 4.0.4 but it was necessary because stable version of sources for our hardware was based on this version. The next issues was my work environment. Besides Android development I'm working with iOS so I have to use Mac OS X and Xcode as development environment.</p>

<p>The main issue in my case was broken AOSP build system for outdated versions of OS. While building of master branch is simple task, building of older versions of Android under new Mac OS X demands some patience and fixing a few bugs in build system.</p>
<p>My work environment looks like this:</p>
<ul>
<li>AOSP 4.0.4 r1.1 (alongside with 4.0.3 and 4.1.1)</li>
<li>Mac OS X 10.7.5</li>
<li>Xcode 4.6.3 and command line tools</li>
<li>GNU Make 3.81</li>
</ul>
<p>All essential moments and complications of AOSP build process is described in official <a href="http://source.android.com/source/">documentation</a>. The documentation gives us information that Mac OS 10.5 or 10.6 are necessary to build 4.0.x branch, also Xcode 3.14 is recommended version of Xcode. Additionally, in the <a href="http://source.android.com/source/known-issues.html#build-error-with-40x-and-earlier-on-macos-107">"Known issues" section</a>, mentioned that Mac OS 10.7 isn't supported for 4.0.x branch.</p>
<p>I was using Mac OS and Xcode for iOS development and I had no intention to move back on previous versions of software. As well as I wanted to solve this quest but not to avoid it.</p>
<h4>Solution</h4>
<p>The initial configuration is well described in official documentation and was set up on my computer: created case-sensitive disk image, installed necessary tools, downloaded sources of Android. And then I ran build with full-eng profile...</p>
<p>Bellow I give descriptions of the issues and solutions for them. They can appear fully or partially, it's related to used version of AOSP and current build environment. In addition to AOSP 4.0.4, 4.0.3 and 4.1.1 were checked too. There is the following trend: the more newer version of AOSP than less issues appear but first 2 issues have place everywhere. Separately necessary to note that emulator will be build correctly and can ne used without problems after all fixes described bellow.</p>
<p>To solve issue with compilator, you need to use the command listed bellow. The vital part is <strong>CC="gcc" CXX="g++"</strong>, alongside with these parameters you can use other in any order or combination.</p>
<pre><code class="language-bash">make CC="gcc" CXX="g++" -j4</code></pre>
<p>So, will look on the issues what you can see while the building process (besides described in the documentation).</p>
<h5>Issue 1</h5>
<pre><code class="language-bash">external/webkit/Source/WebCore/xml/XPathParser.cpp: In member function 'WebCore::XPath::Expression* WebCore::XPath::Parser::parseStatement(const WTF::String&amp;, WTF::PassRefPtr&lt;WebCore::XPathNSResolver&gt;, WebCore::ExceptionCode&amp;)':
external/webkit/Source/WebCore/xml/XPathParser.cpp:480:39: error: too many arguments to function 'int WebCore::XPath::xpathyyparse()'
out/target/product/generic/obj/STATIC_LIBRARIES/libwebcore_intermediates/Source/WebCore/XPathGrammar.hpp:106:5: note: declared here
make: *** [out/target/product/generic/obj/STATIC_LIBRARIES/libwebcore_intermediates/Source/WebCore/xml/XPathParser.o] Error 1</code></pre>
<h6>Solution 1</h6>
<p>You need to apply the patch <a href="https://bugs.webkit.org/show_bug.cgi" id="92264">https://bugs.webkit.org/show_bug.cgi?id=92264</a>. But this patch will be applied with minor error because of difference in context. It's necessary to check rej file and remove a few of old lines which cause the error. The target directory for patch is <strong>/external/webkit/</strong>.</p>
<h6>Important</h6>
<p>While project linking, on final stage of building, you can see the following issues:</p>
<pre><code class="language-bash">prebuilt/darwin-x86/toolchain/arm-linux-androideabi-4.4.x/bin/../lib/gcc/arm-linux-androideabi/4.4.3/../../../../arm-linux-androideabi/bin/ld: out/target/product/generic/obj/STATIC_LIBRARIES/libwebcore_intermediates/libwebcore.a(CSSParser.o): in function WebCore::CSSParser::parseMediaQuery(WebCore::MediaList*, WTF::String const&amp;):external/webkit/Source/WebCore/css/CSSParser.cpp:621: error: undefined reference to 'cssyyparse(WebCore::CSSParser*)'</code></pre>
<p>It happens in relation to changes into CSSParser. Here appears a strange mystery of linker (you won't see such issues for 4.1.1 version). To fix the issue you need to include any changes to CSSParser (but not a comments, something what compiler will count). I changed definition of this method from <strong>cssyyparse(void*)</strong> to <strong>cssyyparse(WebCore::CSSParser*)</strong> or in reverse order. Then you can start rebuild and all will be fine.</p>
<h5>Issue 2</h5>
<pre><code class="language-bash">host SharedLib: libSR_Recognizer (out/host/darwin-x86/obj/lib/libSR_Recognizer.dylib)
Undefined symbols for architecture i386:
  "_canPushAudioIntoRecognizer", referenced from:
      _SR_RecognizerAdvanceImpl in RecognizerImpl.o
      _detectBeginningOfSpeech in RecognizerImpl.o
    ...
ld: symbol(s) not found for architecture i386
collect2: ld returned 1 exit status
make: *** [out/host/darwin-x86/obj/lib/libSR_Recognizer.dylib] Error 1</code></pre>
<h6>Solution 2</h6>
<p>Move definitions to file <strong>/external/srec/portable/include/PortExport.h</strong> from master branch to current branch.</p>
<pre><code class="language-cpp">#if defined(__APPLE_CC__)
#if __APPLE_CC__ &gt;= 5621
#undef PINLINE
#define PINLINE
#endif
#endif</code></pre>
<h5>Issue 3</h5>
<pre><code class="language-bash">host Executable: triangleCM (out/host/darwin-x86/obj/EXECUTABLES/
triangleCM_intermediates/triangleCM)
Undefined symbols:
  "__dyld_func_lookup", referenced from:
      _promoteLocalToGlobal in libSDL.a(SDL_dlcompat.o)
      _dlcompat_init_func in libSDL.a(SDL_dlcompat.o)
    ...
ld: symbol(s) not found
collect2: ld returned 1 exit status
make: *** [out/host/darwin-x86/obj/EXECUTABLES/
triangleCM_intermediates/triangleCM] Error 1</code></pre>
<h6>Solution 3</h6>
<p>Add library <strong>LOCAL_SDL_LDLIBS += /usr/lib/dylib1.o</strong> to <strong>/development/tools/emulator/opengl/tests/translator_tests/</strong> for <strong>/GLES_V2/Android.mk</strong> and <strong>/GLES_CM/Android.mk</strong>.</p>
<h5>Issue 4</h5>
<p>Different definitions of the method <strong>strnlen</strong> in system and local files. Unfortunately, I didn't save log for this issue but you can understand that when see mentioning of strnlen.</p>
<h6>Solution 4</h6>
<p>Add condition for method <strong>strnlen</strong> to <strong>/external/elfutils/config-compat-darwin.h</strong>:</p>
<pre><code class="language-cpp">#if __MAC_OS_X_VERSION_MIN_REQUIRED &lt; 1070
static inline size_t strnlen (const char *__string, size_t __maxlen)
#endif</code></pre>
<h5>Issue 5</h5>
<p>Choosing version of SDK by version of Mac OS to build emulator. It's without log, similar to previous issue. But you will understand when see mentioning of <strong>qemu</strong>.</p>
<h6>Solution 5</h6>
<p>Replace condition for Mac OS version in <strong>/external/qemu/Makefile.android</strong>:</p>
<pre><code class="language-diff">-    ifeq ($(filter 10.5 10.5.%,$(DARWIN_VERSION)),)
+    ifneq ($(filter 10.6 10.6.%,$(DARWIN_VERSION)),)</code></pre>
<p>And add inclusion of libraries for Mac OS:</p>
<pre><code class="language-diff"> ifeq ($(HOST_OS),darwin)
   QEMU_SYSTEM_LDLIBS += -Wl,-framework,Cocoa,-framework,QTKit,-framework,CoreVideo
+  ifneq ($(filter 10.7 10.7.%,$(DARWIN_VERSION)),)
+    # Lion/XCode4 needs to be explicitly told the dynamic library
+    # lookup symbols in the precompiled libSDL are resolved at
+    # runtime
+    QEMU_SYSTEM_LDLIBS += -undefined dynamic_lookup
+  endif
 endif</code></pre>
<h5>Issue 6</h5>
<p>You can see the following issue if you've OS on drive with case-sensitive file system:</p>
<pre><code class="language-bash">external/qemu/android/camera/camera-capture-mac.m:24:24: error: QTKit/QTkit.h: No such file or directory</code></pre>
<h6>Solution 6</h6>
<p>The cause of the issue is simple - misprint in the name of .h file. Instead of the capital 'K' is used small 'k'. Usually, this type of the issues won't appeared because Mac OS installs on drive with case-insensitive file system. To fix the issue you just need to replace letter to the correct one.</p>
<h4>Conclusion</h4>
<p>It's better to build Android under Linux systems but not under Mac OS :). You can use virtual box or just use separate installation of Linux on your computer. As I see, Mac OS can only be a partial alternative for AOSP build environment. Especially considering that all variations of build environment are not checked when Android moves further.</p>
        </div>

        
            
    
        <p class="prev-next">
                            <a class="button" href="fingertron-demon-racing.html"><i class="fa fa-chevron-left"></i> Next Post</a>
            
                    </p>
    
    </div>
</div>
			</div>
			<div id="sidebar" class="block size-1-3 pure-u-1-3">
				
<div class="sidebar-content">
    <h4>Search</h4>
    <div class="search-wrapper">
    <form name="search" onSubmit="return validateSearch(event);">
        <input
            name="searchfield"
            class="search-input"
            type="text"
            pattern=".{3,}"
            required
            oninvalid="this.setCustomValidity('Please add at least 3 characters')" onchange="try{setCustomValidity('')}catch(e){}"
            placeholder="Search..."
            value=""
            data-search-input="/search/query"
        />
            </form>
    <script>
    function validateSearch(event) {
        var input = document.forms["search"]["searchfield"];
        var target = input.getAttribute('data-search-input');
        if (input.value.length >= 3) {
            event.preventDefault();
            window.location.href = target + ':' + input.value;
        } else {
            event.preventDefault();
        }
    }
    </script>
</div>
</div>
    <h4>Related Posts</h4>
    <ul class="related-pages">
                                <li>
                                    <span class="score">60</span>
                                <a href="../random.html" title=""Genie in a bottle" mobile games statistics">"Genie in a bottle" mobile games statistics</a>
            </li>
                                        <li>
                                    <span class="score">50</span>
                                <a href="integration-of-cordova-into-a-native-ios-project.html" title="Integration of Cordova into a native iOS project">Integration of Cordova into a native iOS project</a>
            </li>
            </ul><div class="sidebar-content">
	<h4>Random Article</h4>
	<a class="button" href="../random.html"><i class="fa fa-retweet"></i> I'm Feeling Lucky!</a>
</div>
<div class="sidebar-content">
    <h4>Popular Tags</h4>
    
<span class="tags">
                    <a class="" href="./tag:ios.html">ios</a>
                    <a class="" href="./tag:games.html">games</a>
                    <a class="" href="./tag:development.html">development</a>
                    <a class="" href="./tag:android.html">android</a>
                    <a class="" href="./tag:swift.html">swift</a>
                    <a class="" href="./tag:webview.html">webview</a>
                    <a class="" href="./tag:cordova.html">cordova</a>
                    <a class="" href="./tag:hybrid%20apps.html">hybrid apps</a>
                    <a class="" href="./tag:statistics.html">statistics</a>
                    <a class="" href="./tag:build.html">build</a>
                    <a class="" href="./tag:macOS.html">macOS</a>
                    <a class="" href="./tag:app%20store.html">app store</a>
                    <a class="" href="./tag:google%20play.html">google play</a>
    </span>
</div>
<div class="sidebar-content">
    <h4>Archives</h4>
	<ul class="archives">

    <li>
    	<a href="./archives_month:jan_2020.html">
                <span class="label">1</span>
                <span class="archive_date">January 2020</span>
        </a>
    </li>
    <li>
    	<a href="./archives_month:jan_2018.html">
                <span class="label">1</span>
                <span class="archive_date">January 2018</span>
        </a>
    </li>
    <li>
    	<a href="./archives_month:sep_2017.html">
                <span class="label">1</span>
                <span class="archive_date">September 2017</span>
        </a>
    </li>
    <li>
    	<a href="./archives_month:apr_2017.html">
                <span class="label">1</span>
                <span class="archive_date">April 2017</span>
        </a>
    </li>
</ul>
</div>
<div class="sidebar-content syndicate">
    <h4>Syndicate</h4>
    <a class="button" href="../blog.atom"><i class="fa fa-rss-square"></i> Atom 1.0</a>
    <a class="button" href="../blog.rss"><i class="fa fa-rss-square"></i> RSS</a>
</div>
			</div>
		</div>
	        </section>
        
					<footer id="footer">
	<div class="totop">
		<span><a href="build-android-mac-os.html#" id="toTop"><i class="fa fa-arrow-up"></i></a></span>
	</div>
	<p>Copyright &copy; Genie in a Bottle studio, 2011-2025</p>
</footer>
		    </div>
    <div class="sb-slidebar sb-left sb-width-thin">
        <div id="panel">
        
<ul class="navigation">
                                    <li class="">
                <a href="../index.html">
                                        Home
                </a>
            </li>
                                <li class="active">
                <a href="../blog.html">
                                        Blog
                </a>
            </li>
                                <li class="">
                <a href="../privacy-policy.html">
                                        Privacy Policy
                </a>
            </li>
                                <li class="">
                <a href="../berryboom.html">
                                        Berry Boom!
                </a>
            </li>
                                <li class="">
                <a href="../turbofinger.html">
                                        Turbofinger
                </a>
            </li>
                                <li class="">
                <a href="../fingertron.html">
                                        Fingertron
                </a>
            </li>
                    </ul>

        </div>
    </div>
            <!-- Yandex.Metrika counter -->
<script type="text/javascript">
(function (d, w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter21321733 = new Ya.Metrika({id:21321733,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true});
        } catch(e) { }
    });

    var n = d.getElementsByTagName("script")[0],
        s = d.createElement("script"),
        f = function () { n.parentNode.insertBefore(s, n); };
    s.type = "text/javascript";
    s.async = true;
    s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

    if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f, false);
    } else { f(); }
})(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/21321733" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
        
            
        <script>
        $(function () {
            $(document).ready(function() {
              $.slidebars({
                hideControlClasses: true,
                scrollLock: true
              });
            });
        });
        </script>
    </body>
</html>
